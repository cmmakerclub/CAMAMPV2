#include <Wire.h>
uint8_t Z[]={0,0,0,0,0,0,0,0};
void setup() {
  Serial.begin(115200);
  pinMode(A4, INPUT_PULLUP);
  pinMode(A5, INPUT_PULLUP);
  Wire.begin(10);
  delay(1000);
  Wire.onRequest(requestEvent);
  delay(1000);
  for (int i = 2; i < 14; i++)
    pinMode(i, INPUT);

}
int x[5][17] {};
int valve_prer;
int n;
unsigned long time_now = 0;
unsigned long time_prev;
unsigned long time_prev2;
byte x1 = 0, x2 = 0, x3 = 0, x4 = 0, rank = 0, U_V = 0;
float xmix = 0;
byte xmix1,xmix2,xmix3,xmix4;
  int xmix_int1;
  int xmix_int2;
void loop() {
  //  for (int i = 2; i < 14; i++) {
  //    Serial.print(digitalRead(i));
  //    Serial.print(" ");
  //    delayMicroseconds(1);
  //  }
  //  Serial.println(" ");
  time_now = micros();

  int zxcv = analogRead(A0);
  if (valve_prer > 400 && zxcv < 400)
  {
    n = 4;
    time_prev = time_now;
  }
  if (n > 0)
  {
    uint16_t period = 3750;
    if (n == 4) period = 1875;

    if (time_now - time_prev >= period)
    {
      time_prev = time_now;
      for (int i = 2; i < 14; i++)
        //      x[n][i] = (int)((float)analogRead(i) * (4.8 / 1023.0));
        //      x[n][i] = digitalRead(i);
        x[n][i] = digitalRead(i);
      delayMicroseconds(1);
      n--;
    }
  }
  valve_prer = zxcv;

  if (time_now - time_prev2 > 1000000)
  {
    time_prev2 = time_now;
//    for (int y = 2; y < 14; y++)
//    {
//      Serial.print(" ");
//      Serial.print(y);
//      Serial.print("-");
//      for (int i = 4; i > 0; i--)
//      {
//        x[i][y];
//        Serial.print(x[i][y]);
//      }
//      //  หลักสิบ
//      //    a           b         c           d         e           f         g
//
//    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 1 && x[3][9] == 1 && x[2][9] == 0) { //0
      x2 = 0;
    }
    if (x[4][9] == 0 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 0 && x[2][10] == 0 && x[3][9] == 0 && x[2][9] == 0) { //1
      x2 = 1;
    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 0 && x[1][9] == 1 && x[2][10] == 1 && x[3][9] == 0 && x[2][9] == 1) { //2
      x2 = 2;
    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 0 && x[3][9] == 0 && x[2][9] == 1) { //3
      x2 = 3;
    }
    if (x[4][9] == 0 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 0 && x[2][10] == 0 && x[3][9] == 1 && x[2][9] == 1) { //4
      x2 = 4;
    }
    if (x[4][9] == 1 && x[3][8] == 0 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 0 && x[3][9] == 1 && x[2][9] == 1) { //5
      x2 = 5;
    }
    if (x[4][9] == 1 && x[3][8] == 0 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 1 && x[3][9] == 1 && x[2][9] == 1) { //6
      x2 = 6;
    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 0 && x[2][10] == 0 && x[3][9] == 0 && x[2][9] == 0) { //7
      x2 = 7;
    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 1 && x[3][9] == 1 && x[2][9] == 1) { //8
      x2 = 8;
    }
    if (x[4][9] == 1 && x[3][8] == 1 && x[2][8] == 1 && x[1][9] == 1 && x[2][10] == 0 && x[3][9] == 1 && x[2][9] == 1) { //9
      x2 = 9;
    }
    ////  หลักหน่วย
    //    a           b         c           d         e           f         g
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 1 && x[3][7] == 1 && x[3][6] == 0) { //0
      x1 = 0;
    }
    if (x[4][6] == 0 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 0 && x[2][7] == 0 && x[3][7] == 0 && x[3][6] == 0) { //1
      x1 = 1;
    }
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 0 && x[1][7] == 1 && x[2][7] == 1 && x[3][7] == 0 && x[3][6] == 1) { //2
      x1 = 2;
    }
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 0 && x[3][7] == 0 && x[3][6] == 1) { //3
      x1 = 3;
    }
    if (x[4][6] == 0 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 0 && x[2][7] == 0 && x[3][7] == 1 && x[3][6] == 1) { //4
      x1 = 4;
    }
    if (x[4][6] == 1 && x[3][5] == 0 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 0 && x[3][7] == 1 && x[3][6] == 1) { //5
      x1 = 5;
    }
    if (x[4][6] == 1 && x[3][5] == 0 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 1 && x[3][7] == 1 && x[3][6] == 1) { //6
      x1 = 6;
    }
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 0 && x[2][7] == 0 && x[3][7] == 0 && x[3][6] == 0) { //7
      x1 = 7;
    }
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 1 && x[3][7] == 1 && x[3][6] == 1) { //8
      x1 = 8;
    }
    if (x[4][6] == 1 && x[3][5] == 1 && x[2][6] == 1 && x[1][7] == 1 && x[2][7] == 0 && x[3][7] == 1 && x[3][6] == 1) { //9
      x1 = 9;
    }
    ///หลักร้อย
    //    a           b         c           d         e           f         g
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 1 && x[3][12] == 1 && x[3][11] == 0) { //0
      x3 = 0;
    }
    if (x[4][11] == 0 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 0 && x[2][12] == 0 && x[3][12] == 0 && x[3][11] == 0) { //1
      x3 = 1;
    }
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 0 && x[1][11] == 1 && x[2][12] == 1 && x[3][12] == 0 && x[3][11] == 1) { //2
      x3 = 2;
    }
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 0 && x[3][12] == 0 && x[3][11] == 1) { //3
      x3 = 3;
    }
    if (x[4][11] == 0 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 0 && x[2][12] == 0 && x[3][12] == 1 && x[3][11] == 1) { //4
      x3 = 4;
    }
    if (x[4][11] == 1 && x[3][10] == 0 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 0 && x[3][12] == 1 && x[3][11] == 1) { //5
      x3 = 5;
    }
    if (x[4][11] == 1 && x[3][10] == 0 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 1 && x[3][12] == 1 && x[3][11] == 1) { //6
      x3 = 6;
    }
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 0 && x[2][12] == 0 && x[3][12] == 0 && x[3][11] == 0) { //7
      x3 = 7;
    }
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 1 && x[3][12] == 1 && x[3][11] == 1) { //8
      x3 = 8;
    }
    if (x[4][11] == 1 && x[3][10] == 1 && x[2][11] == 1 && x[1][11] == 1 && x[2][12] == 0 && x[3][12] == 1 && x[3][11] == 1) { //9
      x3 = 9;
    }
    if (x[1][2] == 0) {
      x4 = 0;
    }
    if (x[1][2] == 1) {
      x4 = 1;
    }
    xmix = x4 * 1000 + x3 * 100 + x2 * 10 + x1 * 1;
    if (x[1][12] == 0 && x[1][8] == 0 && x[1][10] == 0) {
      xmix = xmix / 1.0;
    }

    if (x[1][12] == 1 && x[1][8] == 0 && x[1][10] == 0) {
      xmix = xmix / 1000.0;
    }
    if (x[1][12] == 0 && x[1][8] == 1 && x[1][10] == 0) {
      xmix = xmix / 10.0;
    }
    if (x[1][12] == 0 && x[1][8] == 0 && x[1][10] == 1) {
      xmix = xmix / 100.0;
    }
    if (x[2][2] == 1) {
      xmix = -xmix;
    }
    if (x[2][2] == 0) {
      xmix = xmix;
    }
    if (x[3][2] == 0 && x[1][3] == 0 && x[1][4] == 0 && x[4][2] == 0) {
      rank = 6;
    }
    if (x[3][2] == 1 && x[1][3] == 1 && x[1][4] == 0 && x[4][2] == 0) {
      rank = 1;
    }
    if (x[3][2] == 1 && x[1][3] == 0 && x[1][4] == 1 && x[4][2] == 0) {
      rank = 3;
    }
    if (x[3][2] == 0 && x[1][3] == 0 && x[1][4] == 1 && x[4][2] == 1) {
      rank = 4;
    }
    if (x[1][6] == 1) {
      U_V = 0;
    } else {
      U_V = 1;
    }

//    Serial.println(" ");
      if(xmix>0){
   xmix_int1=xmix*1000;
   xmix_int2=0;
  }else if(xmix<0){
   xmix_int1=-xmix*1000;
   xmix_int2=1;
  }else{
  xmix_int1=0;
  xmix_int2=0;
  }
  xmix1=xmix_int1>>8;
  xmix2=xmix_int1;
  xmix3=xmix_int2;
  xmix4=xmix_int2;
  Z[0]=0;
  Z[1]=1;
  Z[2]=xmix1;
  Z[3]=xmix2;
  Z[4]=xmix3;
  Z[5]=xmix4;
  Z[6]=rank;
  Z[7]=U_V;
    Serial.print(Z[2]);
    Serial.print("  ");
    Serial.print(Z[3]);
    Serial.print("  ");
    Serial.print(Z[4]);
    Serial.print("  ");
    Serial.print(Z[5]);
    Serial.print("  ");
    Serial.print(Z[6]);
    Serial.print("  ");
    Serial.print(Z[7]);
    Serial.println(" ");

  }
}
void requestEvent() {
  Wire.write(Z,8); 

}

